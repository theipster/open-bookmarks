#!/bin/bash
GRADLE_CONTAINER=${GRADLE_CONTAINER:-gradled}
GRADLE_USER_HOME=${GRADLE_USER_HOME:-~/.gradle}
GRADLE_VERSION=${GRADLE_VERSION:-6.0.1-jdk8}

# Look for existing daemon, create if required.
cid=`docker container ls -aqf name=$GRADLE_CONTAINER`
if [ -z $cid ]; then
	echo -n "Starting $GRADLE_CONTAINER container... "
	docker run \
		--detach \
		--init \
		--name $GRADLE_CONTAINER \
		--rm \
		--tmpfs /home/gradle/.gradle/daemon \
		--user gradle \
		--volume "$GRADLE_USER_HOME":/home/gradle/.gradle \
		--volume "$PWD":/home/gradle/project \
		--workdir /home/gradle/project \
		gradle:$GRADLE_VERSION \
		tail -f /dev/null
else
	echo "Re-using $GRADLE_CONTAINER container $cid..."
fi

# Run gradle command
docker exec $GRADLE_CONTAINER gradle $@
